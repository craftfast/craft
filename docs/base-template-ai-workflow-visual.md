# Base Template AI Workflow - Visual Guide

## Complete Data Flow

````
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          STEP 1: PROJECT CREATION                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  User clicks "Create Project" with description                             â”‚
â”‚                       â†“                                                     â”‚
â”‚  API: /api/projects (POST)                                                 â”‚
â”‚                       â†“                                                     â”‚
â”‚  getMinimalNextJsTemplate()                                                â”‚
â”‚                       â†“                                                     â”‚
â”‚  Returns 8 base files:                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚  â”‚ â€¢ package.json                      â”‚                                  â”‚
â”‚  â”‚ â€¢ tsconfig.json                     â”‚                                  â”‚
â”‚  â”‚ â€¢ next.config.ts                    â”‚                                  â”‚
â”‚  â”‚ â€¢ tailwind.config.ts                â”‚                                  â”‚
â”‚  â”‚ â€¢ postcss.config.mjs                â”‚                                  â”‚
â”‚  â”‚ â€¢ src/app/layout.tsx                â”‚                                  â”‚
â”‚  â”‚ â€¢ src/app/page.tsx                  â”‚                                  â”‚
â”‚  â”‚ â€¢ src/app/globals.css               â”‚                                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â”‚                       â†“                                                     â”‚
â”‚  prisma.project.create({                                                   â”‚
â”‚    files: baseTemplate  â† SAVED TO DATABASE                               â”‚
â”‚  })                                                                         â”‚
â”‚                       â†“                                                     â”‚
â”‚  Project created with ID                                                   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       STEP 2: USER OPENS PROJECT                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  Navigate to /chat/[project-id]                                            â”‚
â”‚                       â†“                                                     â”‚
â”‚  CodingInterface component mounts                                          â”‚
â”‚                       â†“                                                     â”‚
â”‚  useEffect(() => {                                                         â”‚
â”‚    loadProjectFiles()                                                      â”‚
â”‚  })                                                                         â”‚
â”‚                       â†“                                                     â”‚
â”‚  API: /api/files?projectId=xxx (GET)                                      â”‚
â”‚                       â†“                                                     â”‚
â”‚  Returns all saved files from database                                     â”‚
â”‚                       â†“                                                     â”‚
â”‚  setProjectFiles({                                                         â”‚
â”‚    "package.json": "...",                                                  â”‚
â”‚    "src/app/page.tsx": "...",                                             â”‚
â”‚    ...                                                                     â”‚
â”‚  })                                                                         â”‚
â”‚                       â†“                                                     â”‚
â”‚  State updated with 8 files âœ“                                             â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         STEP 3: USER SENDS MESSAGE                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  User types: "Create a landing page with hero section"                     â”‚
â”‚                       â†“                                                     â”‚
â”‚  ChatPanel component                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚  â”‚ Props received:                     â”‚                                  â”‚
â”‚  â”‚ â€¢ projectId: "abc123"               â”‚                                  â”‚
â”‚  â”‚ â€¢ projectFiles: { ... }  â† 8 files â”‚                                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â”‚                       â†“                                                     â”‚
â”‚  handleSendMessage()                                                       â”‚
â”‚                       â†“                                                     â”‚
â”‚  fetch("/api/chat", {                                                      â”‚
â”‚    body: JSON.stringify({                                                  â”‚
â”‚      messages: [                                                           â”‚
â”‚        { role: "user", content: "Create..." }                             â”‚
â”‚      ],                                                                    â”‚
â”‚      taskType: "coding",                                                   â”‚
â”‚      projectFiles: {  â† FILES SENT!                                       â”‚
â”‚        "package.json": "...",                                             â”‚
â”‚        "src/app/page.tsx": "...",                                         â”‚
â”‚        ... all 8 files                                                     â”‚
â”‚      }                                                                     â”‚
â”‚    })                                                                      â”‚
â”‚  })                                                                         â”‚
â”‚                       â†“                                                     â”‚
â”‚  Request sent to API                                                        â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      STEP 4: AI RECEIVES CONTEXT                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  API: /api/chat (POST handler)                                             â”‚
â”‚                       â†“                                                     â”‚
â”‚  const { messages, taskType, projectFiles } = await req.json()            â”‚
â”‚                                                                             â”‚
â”‚  console.log(`ğŸ“ Context: ${Object.keys(projectFiles).length} files`)     â”‚
â”‚  // Output: "ğŸ“ Context: 8 existing project files"                        â”‚
â”‚                       â†“                                                     â”‚
â”‚  getSystemPrompt(taskType, projectFiles)                                  â”‚
â”‚                       â†“                                                     â”‚
â”‚  getCodingSystemPrompt(projectFiles)                                      â”‚
â”‚                       â†“                                                     â”‚
â”‚  Builds file list context:                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ## Current Project Files (8 files loaded)                          â”‚  â”‚
â”‚  â”‚                                                                     â”‚  â”‚
â”‚  â”‚ The project ALREADY HAS these files saved:                         â”‚  â”‚
â”‚  â”‚                                                                     â”‚  â”‚
â”‚  â”‚ - `next.config.ts`                                                 â”‚  â”‚
â”‚  â”‚ - `package.json`                                                   â”‚  â”‚
â”‚  â”‚ - `postcss.config.mjs`                                             â”‚  â”‚
â”‚  â”‚ - `src/app/globals.css`                                            â”‚  â”‚
â”‚  â”‚ - `src/app/layout.tsx`                                             â”‚  â”‚
â”‚  â”‚ - `src/app/page.tsx`                                               â”‚  â”‚
â”‚  â”‚ - `tailwind.config.ts`                                             â”‚  â”‚
â”‚  â”‚ - `tsconfig.json`                                                  â”‚  â”‚
â”‚  â”‚                                                                     â”‚  â”‚
â”‚  â”‚ **How to work with existing files:**                               â”‚  â”‚
â”‚  â”‚ 1. To UPDATE: ```typescript // src/app/page.tsx                   â”‚  â”‚
â”‚  â”‚ 2. To CREATE: ```typescript // src/components/New.tsx             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                       â†“                                                     â”‚
â”‚  Complete system prompt built with file context                            â”‚
â”‚                       â†“                                                     â”‚
â”‚  streamText({                                                              â”‚
â”‚    model: claude-sonnet-4.5,                                               â”‚
â”‚    system: systemPrompt,  â† Includes file list!                           â”‚
â”‚    messages: [...]                                                         â”‚
â”‚  })                                                                         â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       STEP 5: AI GENERATES RESPONSE                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  AI analyzes:                                                              â”‚
â”‚  âœ“ User wants: "landing page with hero section"                           â”‚
â”‚  âœ“ Existing files: src/app/page.tsx, layout.tsx, etc.                    â”‚
â”‚  âœ“ Knows: Update page.tsx, don't recreate package.json                   â”‚
â”‚                       â†“                                                     â”‚
â”‚  AI streams response:                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ I'll create a modern landing page with a hero section.             â”‚  â”‚
â”‚  â”‚                                                                     â”‚  â”‚
â”‚  â”‚ ```typescript // src/app/page.tsx                                  â”‚  â”‚
â”‚  â”‚ export default function Home() {                                   â”‚  â”‚
â”‚  â”‚   return (                                                         â”‚  â”‚
â”‚  â”‚     <main className="min-h-screen">                                â”‚  â”‚
â”‚  â”‚       <section className="h-screen flex items-center">            â”‚  â”‚
â”‚  â”‚         <div className="max-w-4xl mx-auto">                       â”‚  â”‚
â”‚  â”‚           <h1 className="text-6xl font-bold">                     â”‚  â”‚
â”‚  â”‚             Welcome to Your Site                                  â”‚  â”‚
â”‚  â”‚           </h1>                                                    â”‚  â”‚
â”‚  â”‚         </div>                                                     â”‚  â”‚
â”‚  â”‚       </section>                                                   â”‚  â”‚
â”‚  â”‚     </main>                                                        â”‚  â”‚
â”‚  â”‚   );                                                               â”‚  â”‚
â”‚  â”‚ }                                                                  â”‚  â”‚
â”‚  â”‚ ```                                                                â”‚  â”‚
â”‚  â”‚                                                                     â”‚  â”‚
â”‚  â”‚ This creates a full-screen hero section with centered content.    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                       â†“                                                     â”‚
â”‚  Response streamed back to client                                          â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     STEP 6: FILES SAVED & PREVIEW UPDATES                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  ChatPanel receives streamed response                                       â”‚
â”‚                       â†“                                                     â”‚
â”‚  extractCodeBlocks(content)                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚  â”‚ Found 1 file:                       â”‚                                  â”‚
â”‚  â”‚ â€¢ src/app/page.tsx (updated)        â”‚                                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â”‚                       â†“                                                     â”‚
â”‚  saveFiles([                                                               â”‚
â”‚    { path: "src/app/page.tsx", content: "..." }                           â”‚
â”‚  ])                                                                         â”‚
â”‚                       â†“                                                     â”‚
â”‚  API: /api/files (POST)                                                   â”‚
â”‚  {                                                                         â”‚
â”‚    projectId: "abc123",                                                    â”‚
â”‚    filePath: "src/app/page.tsx",                                          â”‚
â”‚    content: "export default function Home() { ... }"                       â”‚
â”‚  }                                                                          â”‚
â”‚                       â†“                                                     â”‚
â”‚  Database: UPDATE project                                                  â”‚
â”‚  files["src/app/page.tsx"] = new content  â† REPLACES existing            â”‚
â”‚                       â†“                                                     â”‚
â”‚  File saved to database âœ“                                                 â”‚
â”‚                       â†“                                                     â”‚
â”‚  onFilesCreated([{ path: "...", content: "..." }])                        â”‚
â”‚                       â†“                                                     â”‚
â”‚  CodingInterface updates state:                                            â”‚
â”‚  setProjectFiles({                                                         â”‚
â”‚    ...projectFiles,                                                        â”‚
â”‚    "src/app/page.tsx": newContent  â† Updated in state                     â”‚
â”‚  })                                                                         â”‚
â”‚                       â†“                                                     â”‚
â”‚  PreviewPanel detects file change                                          â”‚
â”‚                       â†“                                                     â”‚
â”‚  updateSandboxFiles()                                                      â”‚
â”‚                       â†“                                                     â”‚
â”‚  E2B sandbox receives updated files                                        â”‚
â”‚                       â†“                                                     â”‚
â”‚  Next.js HMR triggers                                                      â”‚
â”‚                       â†“                                                     â”‚
â”‚  Preview refreshes automatically âœ“                                         â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
````

## File Update vs Create Logic

```
AI generates code block with file path
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           â”‚
Path exists in             Path is new
projectFiles?              (not in projectFiles)
â”‚                           â”‚
â”‚                           â”‚
UPDATE                      CREATE
â”‚                           â”‚
Replace existing            Add new file
content in DB               to DB
â”‚                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
     File saved to database
              â†“
     State updated in frontend
              â†“
     E2B sandbox receives file
              â†“
     Preview updates
```

## Example: Multiple File Operations

**User:** "Add a navbar component and update the layout"

**AI sees files:**

- âœ“ `src/app/layout.tsx` (exists)
- âœ— `src/components/Navbar.tsx` (doesn't exist)

**AI response:**

```typescript // src/components/Navbar.tsx  â† NEW (create)
export default function Navbar() {
  return <nav>...</nav>;
}
```

```typescript // src/app/layout.tsx  â† EXISTS (update/replace)
import Navbar from "@/components/Navbar";

export default function RootLayout({ children }) {
  return (
    <html>
      <body>
        <Navbar />
        {children}
      </body>
    </html>
  );
}
```

**Result:**

- Creates: `src/components/Navbar.tsx`
- Updates: `src/app/layout.tsx`
- Total files in project: 9 (was 8)

## State Management Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CodingInterface (Parent)                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ State: projectFiles = { ... 8 files ... }                â”‚ â”‚
â”‚ â”‚        isGeneratingFiles = false                         â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                              â”‚
â”‚     Props â†“                            Callback â†‘            â”‚
â”‚                                                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  ChatPanel         â”‚           â”‚  PreviewPanel          â”‚ â”‚
â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚ â”‚  â”‚ projectFiles â”‚  â”‚           â”‚  â”‚ projectFiles     â”‚  â”‚ â”‚
â”‚ â”‚  â”‚ (8 files)    â”‚  â”‚           â”‚  â”‚ (8 files)        â”‚  â”‚ â”‚
â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚ â”‚         â†“          â”‚           â”‚         â†“              â”‚ â”‚
â”‚ â”‚  Send to AI        â”‚           â”‚  Send to E2B          â”‚ â”‚
â”‚ â”‚  with context      â”‚           â”‚  sandbox              â”‚ â”‚
â”‚ â”‚         â†“          â”‚           â”‚                        â”‚ â”‚
â”‚ â”‚  AI generates      â”‚           â”‚                        â”‚ â”‚
â”‚ â”‚  code              â”‚           â”‚                        â”‚ â”‚
â”‚ â”‚         â†“          â”‚           â”‚                        â”‚ â”‚
â”‚ â”‚  onFilesCreated() â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â†’ Updates state       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â†“                    â”‚
â”‚                              PreviewPanel auto-refreshes     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Key Insights

### ğŸ¯ Single Source of Truth

- Database stores all files
- State synchronized with database
- AI always has current context

### ğŸ”„ Update, Don't Recreate

- AI updates existing files by path
- Preserves base template integrity
- Only creates what's truly new

### âš¡ Real-time Sync

- Files â†’ Database â†’ State â†’ Preview
- All parts stay synchronized
- No manual refresh needed

### ğŸ§  Context-Aware AI

- Knows project structure
- Makes informed decisions
- Surgical updates, not full rewrites
